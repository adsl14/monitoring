<!DOCTYPE html>
<html>
<head>

	<title>Visor arroz 1.1.1 - tramos</title>
	<meta charset="UTF-8">

	<link rel="stylesheet" href="libs/leaflet/leaflet.css" />
	<script src="libs/leaflet/leaflet.js"></script>
	<script type="text/javascript" src="libs/leaflet/shp.js"></script>
	<script type="text/javascript" src="libs/leaflet/leaflet.shpfile.js"></script>

	<script type="text/javascript" src="libs/jquery-3.4.1.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>

	<script type="text/javascript" src="libs/bundle.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>

	<!-- logos -->
	<script type="text/javascript" src="assets/andalucia.jpg.js"></script>

	<div id="imageTimeScript"></div>

	<script>

		var nameFolderImages = "plots_juntaShapes_tramos";
		var layerColors = ["cyan", "orange"];
		var layerNames = ["Cumple", "No cumple"];
		var numLayersColors = layerColors.length;
		var pointer_selectedRegion;
		var fullname;
		var campaings = [];
		var numCampaings = 0;

		var region_size = {width: 800,height: 600, className: 'region'};

		function disableMap()
		{
			mymap.dragging.disable();
			mymap.touchZoom.disable();
			mymap.doubleClickZoom.disable();
			mymap.scrollWheelZoom.disable();
			mymap.boxZoom.disable();
			mymap.keyboard.disable();
			mymap.removeLayer(ortofoto);
			mymap.removeLayer(sigpac);
			mymap.removeLayer(topografico);
			if (mymap.tap) mymap.tap.disable();
			document.getElementById('mapid').style.cursor='default';
			document.getElementsByClassName('leaflet-control-container')[0].style.visibility = 'hidden';
		}

		function enableMap()
		{
			mymap.dragging.enable();
			mymap.touchZoom.enable();
			mymap.doubleClickZoom.enable();
			mymap.scrollWheelZoom.enable();
			mymap.boxZoom.enable();
			mymap.keyboard.enable();
			mymap.addLayer(ortofoto);
			if (mymap.tap) mymap.tap.enable();
			document.getElementById('mapid').style.cursor='grab';
			document.getElementsByClassName('leaflet-control-container')[0].style.visibility = 'visible';
		}

		function getScript(url, callback) 
		{
			var script = document.createElement('script');
			script.type = 'text/javascript';
			script.src = url;

			script.onreadystatechange = callback;
			script.onload = callback;

			var div = document.getElementById('imageTimeScript')
			// Remove last child
			div.innerHTML = ''

			// Add new script
			div.appendChild(script);
		}

		//Generate pdf from one area
		async function generatePDF_area(pdf_area_button)
		{
			document.getElementById("message").innerHTML = "Generando PDF del recinto..."

			// Disable map interaction
			disableMap()

			// disable the buttons in order to avoid other clicks
			var pdf_areas_button = document.getElementById("pdf_areas");
			var file_button = document.getElementById("file");
			var submit_button = document.getElementById("submit");
			pdf_areas_button.disabled=true;
			pdf_area_button.disabled = true;
			file_button.disabled = true;
			submit_button.disabled = true;		

			// Move camera to the region
			latLong = pointer_selectedRegion.getBounds().getCenter();
			mymap.setView([latLong.lat, latLong.lng], 15);

			// Wait until the map is in position
			await new Promise(r => setTimeout(r, 500));

			// Export pdf with the information
			domtoimage.toPng(document.getElementById('mapid')).then(function (mapImage) 
			{
				html2canvas(document.getElementById("rectangle"), {
						onrendered: function(canvas) {

							var rectangleImage = canvas.toDataURL('image/png');

						html2canvas(document.getElementById("rectangle2"), {
							onrendered: function(canvas) {

								var rectangle2Image = canvas.toDataURL('image/png');

								html2canvas(document.getElementById("rectangle3"), {
									onrendered: function(canvas) {

										var rectangle3Image = canvas.toDataURL('image/png');

										html2canvas(document.getElementById("rectangle4"), {
											onrendered: function(canvas) {

												var rectangle4Image = canvas.toDataURL('image/png');

												html2canvas(document.getElementById("black_line"), {
													onrendered: function(canvas) {

														var black_lineImage = canvas.toDataURL('image/png');

														html2canvas(document.getElementById("black_line2"), {
															onrendered: function(canvas) {

																var black_line2Image = canvas.toDataURL('image/png');


																html2canvas(document.getElementById("black_line3"), {
																	onrendered: function(canvas) {

																		var black_line3Image = canvas.toDataURL('image/png');

																		var doc = new jsPDF('p', 'mm', 'a4');
																		doc.addImage(document.getElementById("plotImage").src,'PNG',0,-28,140,350)
																		doc.addImage(rectangleImage, 'PNG', 21.61, 14.0, 26.15, 269.5);
																		doc.addImage(rectangle2Image, 'PNG', 47.76, 14.0, 26.15, 269.5);
																		doc.addImage(rectangle3Image, 'PNG', 73.91, 14.0, 29.15, 269.5);
																		doc.addImage(rectangle4Image, 'PNG', 103.06, 14.0, 19.15, 269.5);
																		doc.addImage(black_lineImage, 'PNG', 47.76, 14.0, 0.3, 269.5);
																		doc.addImage(black_line2Image, 'PNG', 73.91, 14.0, 0.3, 269.5);
																		doc.addImage(black_line3Image, 'PNG', 103.06, 14.0, 0.3, 269.5);
																		doc.addImage(mapImage,'PNG',135.5,13.2,70,50);
																		doc.addImage(andalucia,'PNG',3,3,10,10);
																		doc.setFontSize(11);
																		doc.text(fullname,70,8.5)
																		doc.save(fullname+'.pdf');																
																	}
																});													
															}
														});											
													}
												});			
											}
										});									
									}
								});							
							}
						});   
					}
				});

			})

			// Reset everything
			await new Promise(r => setTimeout(r, 4000));
			pdf_areas_button.disabled=false;
			pdf_area_button.disabled = false;
			file_button.disabled = false;
			submit_button.disabled = false;

			enableMap()

			document.getElementById("message").innerHTML = "PDF creado correctamente."

		}

		//Generate pdf from one area
		async function generatePDF_areas(pdf_areas_button)
		{

			// Message
			document.getElementById("message").innerHTML = "Generando PDFs del expediente..."
			await new Promise(r => setTimeout(r, 50));

			// Disable map interaction
			disableMap()

			// disable the buttons in order to avoid other clicks
			var pdf_area_button = document.getElementById("pdf_area");
			var file_button = document.getElementById("file");
			var submit_button = document.getElementById("submit");
			pdf_areas_button.disabled=true;
			pdf_area_button.disabled = true;
			file_button.disabled = true;
			submit_button.disabled = true;

			num_expdi_pointer = pointer_selectedRegion.feature.properties.NUM_EXPEDI
			id_pointer = pointer_selectedRegion.feature.properties.ID
			campana_pointer = pointer_selectedRegion.feature.properties.CAMPANA

			// Get layergroup by searching it in the array of campaings
			for(var i = 0; i < numCampaings; ++i)
			{
				campana = campaings[i][3][0].feature.properties.CAMPANA

				// get layers from the campaing that the user has selected
				if (campana_pointer == campana)
				{
					layers = campaings[i][3]
					break
				}
			}

			// Reset pointed selection to class color
			pointer_selectedRegion.setStyle({color: "black", fillOpacity: 0.1});
			// Save in a aux var the original image
			var imagePointer = document.getElementById("plotImage").src

			// Get regions that have the same num_expedi
			var numLayers = layers.length;
			for(var i = 0; i < numLayers; ++i)
			{
				if (num_expdi_pointer == layers[i].feature.properties.NUM_EXPEDI)
				{
					// Get the name of the layer
					halfname = layers[i].feature.properties.CLAVE_REC + "-" + layers[i].feature.properties.ID
					fullname = layers[i].feature.properties.NUM_EXPEDI + "-" + halfname

					// Move camera to the region and change the color to red
					latLong = layers[i].getBounds().getCenter();
					mymap.setView([latLong.lat, latLong.lng], 15);

					// Change the image in the visor
		    		halfname = layers[i].feature.properties.CLAVE_REC + "-" + layers[i].feature.properties.ID
					fullname = layers[i].feature.properties.NUM_EXPEDI + "-" + halfname
					document.getElementById("textImage").innerHTML = fullname
					getScript("images/"+nameFolderImages+"/"+halfname+".png.js", function()
					{
		    			document.getElementById("plotImage").src = imageTime
		    		});
		    		document.getElementById("rectangle").style.background = layerColors[layers[i].feature.properties.CLASS];
		    		document.getElementById("rectangle2").style.background = layerColors[layers[i].feature.properties.CLASS2];
		    		document.getElementById("rectangle3").style.background = layerColors[layers[i].feature.properties.CLASS3];
		    		document.getElementById("rectangle4").style.background = layerColors[layers[i].feature.properties.CLASS4];
					layers[i].setStyle({color: "red", fillOpacity: 0.1});
					
					// Wait until the map is in position
					await new Promise(r => setTimeout(r, 500));					

					// Export pdf with the information
					domtoimage.toPng(document.getElementById('mapid')).then(function (mapImage) 
					{
						html2canvas(document.getElementById("rectangle"), {
								onrendered: function(canvas) {

									var rectangleImage = canvas.toDataURL('image/png');

								html2canvas(document.getElementById("rectangle2"), {
									onrendered: function(canvas) {

										var rectangle2Image = canvas.toDataURL('image/png');

										html2canvas(document.getElementById("rectangle3"), {
											onrendered: function(canvas) {

												var rectangle3Image = canvas.toDataURL('image/png');

												html2canvas(document.getElementById("rectangle4"), {
													onrendered: function(canvas) {

														var rectangle4Image = canvas.toDataURL('image/png');

														html2canvas(document.getElementById("black_line"), {
															onrendered: function(canvas) {

																var black_lineImage = canvas.toDataURL('image/png');

																html2canvas(document.getElementById("black_line2"), {
																	onrendered: function(canvas) {

																		var black_line2Image = canvas.toDataURL('image/png');


																		html2canvas(document.getElementById("black_line3"), {
																			onrendered: function(canvas) {

																				var black_line3Image = canvas.toDataURL('image/png');

																		    	// Create pdf
																				var doc = new jsPDF('p', 'mm', 'a4');
																				doc.addImage(imageTime,'PNG',0,-28,140,350)
																				doc.addImage(rectangleImage, 'PNG', 21.61, 14.0, 26.15, 269.5);
																				doc.addImage(rectangle2Image, 'PNG', 47.76, 14.0, 26.15, 269.5);
																				doc.addImage(rectangle3Image, 'PNG', 73.91, 14.0, 29.15, 269.5);
																				doc.addImage(rectangle4Image, 'PNG', 103.06, 14.0, 19.15, 269.5);
																				doc.addImage(black_lineImage, 'PNG', 47.76, 14.0, 0.3, 269.5);
																				doc.addImage(black_line2Image, 'PNG', 73.91, 14.0, 0.3, 269.5);
																				doc.addImage(black_line3Image, 'PNG', 103.06, 14.0, 0.3, 269.5);
																				doc.addImage(mapImage,'PNG',135.5,13.2,70,50);
																				doc.addImage(andalucia,'PNG',3,3,10,10);
																				doc.setFontSize(11);
																				doc.text(fullname,70,8.5)
																				doc.save(fullname+'.pdf');					
																			}
																		});													
																	}
																});											
															}
														});			
													}
												});									
											}
										});							
									}
								});   
							}
						});						

					})

					// We have to stop the code here in order to load the image correctly
					await new Promise(r => setTimeout(r, 4000));
					layers[i].setStyle({color: "black", fillOpacity: 0.1});
				}
			}

			// Reset buttons
			pdf_areas_button.disabled=false;
			pdf_area_button.disabled = false;
			file_button.disabled = false;
			submit_button.disabled = false;

			// Reset pointed selection
			latLong = pointer_selectedRegion.getBounds().getCenter();
			mymap.setView([latLong.lat, latLong.lng], 15);
			pointer_selectedRegion.setStyle({color: "red", fillOpacity: 0.1});
			halfname = pointer_selectedRegion.feature.properties.CLAVE_REC + "-" + pointer_selectedRegion.feature.properties.ID
			fullname = pointer_selectedRegion.feature.properties.NUM_EXPEDI + "-" + halfname
			document.getElementById("textImage").innerHTML = fullname
    		document.getElementById("plotImage").src = imagePointer
    		document.getElementById("rectangle").style.background = layerColors[pointer_selectedRegion.feature.properties.CLASS];
    		document.getElementById("rectangle2").style.background = layerColors[pointer_selectedRegion.feature.properties.CLASS2];
    		document.getElementById("rectangle3").style.background = layerColors[pointer_selectedRegion.feature.properties.CLASS3];
    		document.getElementById("rectangle4").style.background = layerColors[pointer_selectedRegion.feature.properties.CLASS4];

			enableMap();

			document.getElementById("message").innerHTML = "PDFs creados correctamente."
		}

		// Check if we are loaded a campaing before
		function checkElementInArray(nameFile, array)
		{

			var tam = array.length;

			for(var i=0; i < tam; ++i)
			{
				if(array[i][0] == nameFile)
					return true;
			}

			return false;
		}

		//More info: https://developer.mozilla.org/en-US/docs/Web/API/FileReader
		function handleZipFile(file)
		{
			var reader = new FileReader();
		  reader.onload = function(){
			  if (reader.readyState != 2 || reader.error){
				  return;
			  } else {
				  convertToLayer(reader.result);
		  	}
		  }
		  reader.readAsArrayBuffer(file);
		}

		function convertToLayer(buffer)
		{

			shp(buffer).then(function(geojson)
			{	

				// Get layer group	
			    var layerGroup = L.shapefile(geojson);

			    // Get lat and long and modify map position
			    var latLong = layerGroup.getBounds().getCenter();
			    mymap.setView([latLong.lat, latLong.lng], 11.4);

			    // Get layers array
			    var layers = layerGroup.getLayers();
			    var n_layers = layers.length;

			    // If the pointer is null when we load a shape, we address the first layer to the pointer
				if (pointer_selectedRegion == null)
		    		pointer_selectedRegion = layers[0];

			    for(var i=0;i < n_layers; i++)
			    {
			    	// Change color
					layers[i].setStyle({color: "black", fillOpacity: 0.1});

					// Sum regions class
			    	campaings.slice(-1)[0][layers[i].feature.properties.CLASS+1]++;

					// Add click event
			    	layers[i].on('click', function() 
			    	{

			    		// Change image and text name
			    		halfname = this.feature.properties.CLAVE_REC + "-" + this.feature.properties.ID
			    		fullname = this.feature.properties.NUM_EXPEDI + "-" + halfname
			    		document.getElementById("textImage").innerHTML = fullname
			    		// Get image var from javascript
			    		//document.getElementById("plotImage").src = "./plots/" + this.feature.properties.ID + ".png"
						getScript("images/"+nameFolderImages+"/"+halfname+".png.js", function()
						{
							document.getElementById("plotImage").src = imageTime
						});

			    		// Color rectangle
			    		document.getElementById("rectangle").style.background = layerColors[this.feature.properties.CLASS];
			    		document.getElementById("rectangle2").style.background = layerColors[this.feature.properties.CLASS2];
			    		document.getElementById("rectangle3").style.background = layerColors[this.feature.properties.CLASS3];
			    		document.getElementById("rectangle4").style.background = layerColors[this.feature.properties.CLASS4];

			    		// Show selected region
						// Reset region
						pointer_selectedRegion.setStyle({color: "black", fillOpacity: 0.1});
						
						// Change selected region
						this.setStyle({color: "red", fillOpacity: 0.1});

						// Update pointer
						pointer_selectedRegion = this;

			    		// Show image div and generator buttons
			    		if (document.getElementById("imageDiv").style.visibility == "hidden")
			    		{
							document.getElementById("pdf_area").disabled = false;
							document.getElementById("pdf_areas").disabled = false;
			    			document.getElementById("imageDiv").style.visibility = "visible";
			    		}

			    	})

			    }

			    var percentages = "";
			    // Get percentages last campaing
			    for(var i = 1; i < numLayersColors+1; ++i)
			    	campaings.slice(-1)[0][i] =  ((campaings.slice(-1)[0][i]/n_layers) * 100).toFixed(2);

			    // Add layerGroup to layer control and activate it
			    var fileName = document.getElementById('file').files[0].name
				layerControl.addOverlay(layerGroup , campaings.slice(-1)[0][0].slice(0,-4));
				layerGroup.addTo(mymap);

				// Show legend
				if (document.getElementById("border_legend").style.visibility == "hidden")
					document.getElementById("border_legend").style.visibility = "visible";

				// Show 'shape loaded' message
				document.getElementById('message').innerHTML = 'Shape ' + fileName + ' cargado.';

				// Save layers in campaing array
				campaings.slice(-1)[0][3] = layers
			});
		}

 		async function loadCampaing(object)
 		{

			var files = document.getElementById('file').files;

			if (files.length == 0)
			{
				document.getElementById('message').innerHTML = 'Debe seleccionar una campaña primero.'; // Avoid loading the same shapefile
				return; //do nothing if no file given yet
			}
		  
			var file = files[0];

		  
			if (file.name.slice(-3) != 'zip'){ //Demo only tested for .zip. All others, return.

				document.getElementById('message').innerHTML = 'Selecciona un fichero .zip';  	
				return;

			}
			else if(checkElementInArray(file.name,campaings))
			{
				document.getElementById('message').innerHTML = 'Shape ' + file.name + ' anteriormente ya cargado.'; // Avoid loading the same shapefile
				return;
			}

			else 
			{
	 			// disable the button in order to avoid other clicks
	 			var pdf_area_button = document.getElementById("pdf_area");
	 			var pdf_areas_button = document.getElementById("pdf_areas");
	 			var file_button = document.getElementById("file");
				object.disabled=true;
				file_button.disabled=true;
				pdf_area_button.disabled=true;
				pdf_areas_button.disabled=true;

				// Save fileName to a list
				document.getElementById('message').innerHTML = 'Cargando shape ' + file.name; //clear warning message.
				await new Promise(r => setTimeout(r, 50));

				campaings.push([file.name,0.0,0.0,[]]);
				numCampaings = numCampaings + 1
				handleZipFile(file);

				object.disabled=false;
				file_button.disabled=false;

				// Only reset these inputs when the user has selected one region
				if(pointer_selectedRegion != null)
				{
					pdf_area_button.disabled=false;
					pdf_areas_button.disabled=false;
				}
			}		
 		}

	</script>

	<style type="text/css">

		.rectangle_color{

			position: absolute;
			width: 120px;
			height: 1202px; 
			margin-left: 103px;
			margin-top: -1px; 
			opacity: 0.3;
		}

		.rectangle_black_line{

			position: absolute;
			background: black;
			width: 2px;
			height: 1202px; 
			margin-left: 223px;
			margin-top: -1px; 
			opacity: 0.7;
		}		

		.rectangle2_color{

			position: absolute;
			width: 120px;
			height: 1202px; 
			margin-left: 223px;
			margin-top: -1px; 
			opacity: 0.3;
		}

		.rectangle2_black_line{

			position: absolute;
			background: black;
			width: 2px;
			height: 1202px; 
			margin-left: 343px;
			margin-top: -1px; 
			opacity: 0.7;
		}		

		.rectangle3_color{

			position: absolute;
			width: 137px;
			height: 1202px; 
			margin-left: 343px;
			margin-top: -1px; 
			opacity: 0.3;
		}

		.rectangle3_black_line{

			position: absolute;
			background: black;
			width: 2px;
			height: 1202px; 
			margin-left: 480px;
			margin-top: -1px; 
			opacity: 0.7;
		}		

		.rectangle4_color{

			position: absolute;
			width: 85px;
			height: 1202px; 
			margin-left: 480px;
			margin-top: -1px; 
			opacity: 0.3;
		}	

		#border_legend {

			width: 170px;
			height: 100px;
			border-width: 2px;
			border-color: black;
			border-style: solid;
		}

		#legend_yes{

			position: absolute;
			width: 35px;
			height: 35px; 
			margin-left: 10px;
			margin-top: 10px;
			background : cyan;
		}

		#text_legend_yes {

			position: absolute;
			white-space: nowrap;
			margin-top: 20px;
			margin-left: 60px;
		}

		#legend_no{

			position: absolute;
			width: 35px;
			height: 35px; 
			margin-left: 10px;
			margin-top: 55px;
			background : orange;
		}


		#text_legend_no {

			position: absolute;
			white-space: nowrap;
			margin-top: 65px;
			margin-left: 60px;
		}

	</style>

</head>

<body>

	<!-- Logos -->
	<a href="https://www.juntadeandalucia.es/" target="_blank" rel="noopener noreferrer"><img style="width: auto !important; height: 60px !important;" src="assets/andalucia.jpg" alt="Junta de Andalucía"></a>
	<a href="https://www.uco.es/etsiam/es/" target="_blank" rel="noopener noreferrer"><img style="width: auto !important; height: 60px !important;" src="assets/etsiam.jpg" alt="ETSIAM"></a>
	<a href="http://www.uco.es/" target="_blank" rel="noopener noreferrer"><img style="width: auto !important; height: 60px !important;" src="assets/Logo_UCO.png" alt="UCO"></a>

	<!-- map -->
	<div id="mapid" style="width: 1280px; height:720px; margin:10px"></div>

	<!-- Inputs -->
	<div id="inputs" style="margin-top: 10px;">
		<input type="file" id="file">
		<input type="submit" id="submit" value="Cargar campaña" onclick="loadCampaing(this)"> <br> <br>
		<label id="message_PDF" style="display:inline">Generar PDF:</label>
		<input type="button" id="pdf_area" value="recinto" onclick="generatePDF_area(this)" autocomplete="off" disabled>
		<input type="button" id="pdf_areas" value="código expediente" onclick="generatePDF_areas(this)" autocomplete="off" disabled> <br> <br>
		<label id="message"></label>
	</div>

	<!-- Div Image, caption, rectangle -->	
	<div id="imageDiv" style="margin-left: 1280px; margin-top: -1015px; position:absolute; visibility: hidden;"> 
		<img id="plotImage" src="" alt="NULL" width="650px" height="1560px">
		<p id="textImage" style="margin-left: 200px; margin-top: -1410px; white-space: nowrap;"></p>
		<div id="rectangle" class="rectangle_color"></div>
		<div id="rectangle2" class="rectangle2_color"></div>
		<div id="rectangle3" class="rectangle3_color"></div>
		<div id="rectangle4" class="rectangle4_color"></div>
		<div id="black_line" class="rectangle_black_line"></div>
		<div id="black_line2" class="rectangle2_black_line"></div>
		<div id="black_line3" class="rectangle3_black_line"></div>
	</div>

	<!-- Legend -->
	<!-- -470 1100-->
	<div id=border_legend style="margin-top: -100px; margin-left: 1117px; position:absolute; visibility: hidden;">
		<div id="legend_yes"></div>
		<p id=text_legend_yes>Cumple</p>
		<div id="legend_no"></div>
		<p id=text_legend_no>No cumple</p>
	</div>

	<script type="text/javascript">

		// Var mymap
		var mymap = L.map('mapid');
		mymap.setView([37.55, -5.08], 8);

		// Ortofoto
		var ortofoto = L.tileLayer.wms("http://www.ign.es/wms-inspire/pnoa-ma", {
		layers: "OI.OrthoimageCoverage",//layer name (see get capabilities)
		format: 'image/jpeg',
		transparent: true,
		version: '1.3.0',//wms version (see get capabilities)
		attribution: 'PNOA máxima actualidad © <a href="http://www.ign.es/ign/main/index.do" target="_blank">Instituto Geográfico Nacional de España</a>',
		continuousWorld:true
		}).addTo(mymap);

		// Mapa topográfico
		var topografico = L.tileLayer.wms("http://www.juntadeandalucia.es/institutodeestadisticaycartografia/geoserver-ieca/bca/wms?", {
			layers: "00_BCA",		
			format: 'image/png',
			transparent: true,
			attribution: "Mapa Topográfico Andalucía 2007. Cedido por © Instituto Estadística y Cartografía de Andalucía",
			continuousWorld:true
		});

		// Mapa topográfico
		var sigpac = L.tileLayer.wms("http://wms.mapama.es/wms/wms.aspx", {
			layers: "RECINTO",		
			format: 'image/png',
			transparent: true,
			attribution: "Sigpac",
			continuousWorld:true
		});

		var layers_map = {"PNOA max. actualidad" : ortofoto, "Mapa Topográfico de Andalucía" : topografico, "Sigpac": sigpac};
		var layerControl = L.control.layers(layers_map).addTo(mymap);

		// easyPrint plugin
		var printPlugin = L.easyPrint({hidden: true,exportOnly: true, sizeModes: ['CurrentSize', 'A4Portrait', 'A4Landscape', region_size]}).addTo(mymap);

	</script>

</body>
</html>